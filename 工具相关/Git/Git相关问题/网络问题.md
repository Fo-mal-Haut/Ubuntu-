# git clone速度慢
**问题描述**：一个项目，之前在ubuntu系统上成功git clone。但是现在更换到macbook之后，同样是采用代理，但是git clone速度太慢了
## 一、确保终端（Terminal）走代理

在 macOS 上，系统代理（设置里的开关）往往只对浏览器生效，终端（iTerm2 或 Terminal）默认是不走代理的。

**检验方式**：
```shell
curl -vv https://www.google.com
```

**返回情况**：
```shell
fomalhaut@192 obsidian % curl -vv https://www.google.com
* Host www.google.com:443 was resolved.
* IPv6: (none)
* IPv4: 31.13.94.41
*   Trying 31.13.94.41:443...1
```

**情况解释**：
- **DNS 污染/偏移**：解析到的 IP `31.13.94.41` 实际上属于 **Meta (Facebook)**，而不是 Google。这说明你的 DNS 解析被运营商劫持或指向了错误的节点。
- **连接超时**：`Trying 31.13.94.41:443...` 后面卡住，说明流量没有走你的代理通道，而是直连了，自然无法接通。

### 解决措施

**1. `export` 命令（临时补丁）**

直接在终端输入 `export https_proxy=...`

- **生效范围**：仅限**当前终端窗口**。一旦关闭窗口或新建标签页，配置立即失效。
- **优点**：灵活性极高。如果你平时不需要代理，只在偶尔克隆大型项目时用一下，这种方法最干净，不会污染全局环境。
- **缺点**：每次打开新窗口都要重新输入（或按向上键找历史记录），比较麻烦。

**2. 修改`~/.zshrc`文件**

- 运行`nano ~/.zshrc`
- 在文件末尾添加以下代码： **（注意修改为实际代理）**
```shell
# 开启代理的快捷命令
alias proxy='export https_proxy=http://127.0.0.1:7897 http_proxy=http://127.0.0.1:7897 all_proxy=socks5://127.0.0.1:7897'
    
# 关闭代理的快捷命令
alias unproxy='unset https_proxy http_proxy all_proxy'
```
- 保存退出后，执行 `source ~/.zshrc` 使其生效。

## 二、排查 SSH 协议

如果在 Ubuntu 用的是 SSH 链接（`git@github.com:...`），而 Mac 上没有配置 SSH 代理，速度会极慢。

**解决办法**： 编辑 Mac 上的 `~/.ssh/config`，添加以下内容：
```Plaintext
Host github.com
HostName github.com
User git
# Mac 专用：使用 nc (netcat) 转发流量
ProxyCommand nc -X 5 -x 127.0.0.1:7890 %h %p
```
_注：`-X 5` 表示使用 socks5 协议。_

## 三、清理DNS缓存

Mac 在处理 `mDNSResponder` 时有时会缓存错误的解析记录。

1. **清理 DNS 缓存**：
```Bash
sudo killall -HUP mDNSResponder
```

2. **强制 IPv4**（可选）： 有时候代理对 IPv6 支持不佳，克隆时加上 `-4`：
```Bash
git clone -4 https://github.com/username/repo.git
```