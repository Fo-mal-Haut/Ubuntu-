在macOS上使用终端，有时候往往开了网络代理也无法连接网络，那是因为macOS终端不用启用代理。本问题最早出现在git clone的尝试中[网络问题](../../工具相关/Git/Git相关问题/网络问题.md).现在会对网络问题进行一个总结。

## 一、确保终端（Terminal）走代理

在 macOS 上，系统代理（设置里的开关）往往只对浏览器生效，终端（iTerm2 或 Terminal）默认是不走代理的。

**检验方式**：
```shell
curl -vv https://www.google.com
```

**返回情况**：
```shell
fomalhaut@192 obsidian % curl -vv https://www.google.com
* Host www.google.com:443 was resolved.
* IPv6: (none)
* IPv4: 31.13.94.41
*   Trying 31.13.94.41:443...1
```

**情况解释**：
- **DNS 污染/偏移**：解析到的 IP `31.13.94.41` 实际上属于 **Meta (Facebook)**，而不是 Google。这说明你的 DNS 解析被运营商劫持或指向了错误的节点。
- **连接超时**：`Trying 31.13.94.41:443...` 后面卡住，说明流量没有走你的代理通道，而是直连了，自然无法接通。

### 解决措施

**1. `export` 命令（临时补丁）**

直接在终端输入 `export https_proxy=...`

- **生效范围**：仅限**当前终端窗口**。一旦关闭窗口或新建标签页，配置立即失效。
- **优点**：灵活性极高。如果你平时不需要代理，只在偶尔克隆大型项目时用一下，这种方法最干净，不会污染全局环境。
- **缺点**：每次打开新窗口都要重新输入（或按向上键找历史记录），比较麻烦。

**2. 修改`~/.zshrc`文件**

- 运行`nano ~/.zshrc`
- 在文件末尾添加以下代码： 
```shell
# 开启代理的快捷命令
alias proxy='export https_proxy=http://127.0.0.1:7897 http_proxy=http://127.0.0.1:7897 all_proxy=socks5://127.0.0.1:7897'
    
# 关闭代理的快捷命令
alias unproxy='unset https_proxy http_proxy all_proxy'
```
- 保存退出后，执行 `source ~/.zshrc` 使其生效。

**以上代码的作用**：
1. **创建别名 `proxy`**：这个命令**只是被定义，但不会自动执行**。只有你在终端**手动输入 `proxy` 并回车**后，代理环境变量才会被设置。
2. **创建别名 `unproxy`**：同样，只有**手动输入 `unproxy`** 才会清除代理设置。

**3.验证是否有效**

```Shell
# 查看代理环境变量是否被设置
echo $https_proxy
echo $http_proxy
# 如果返回空行，说明代理未开启

# 输入你定义的命令来开启
proxy

# 再次查看
echo $https_proxy
# 现在应该显示：http://127.0.0.1:7897
```